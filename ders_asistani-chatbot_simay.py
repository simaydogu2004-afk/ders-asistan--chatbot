# -*- coding: utf-8 -*-
"""Untitled3.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1nbzKBr6usGehcmXXVMPkP-Y1AIjZPIsP
"""

# -*- coding: utf-8 -*-
"""
ğŸ¤– DERS ASÄ°STANI CHATBOT - GÃœNCEL NUMPY SÃœRÃœMÃœ
"""

# %%
# 1. GEREKLÄ° KÃœTÃœPHANELERÄ° YÃœKLE (GÃœNCEL VERSÄ°YONLARLA)
!pip install -q --upgrade pip
!pip install -q numpy
!pip install -q pymupdf PyPDF2

print("âœ… KÃ¼tÃ¼phaneler yÃ¼klendi!")

# %%
# 2. GEREKLÄ° Ä°MPORT'LAR
import numpy as np
import re
import math
from collections import Counter
import json
import os

print("âœ… Temel kÃ¼tÃ¼phaneler import edildi!")
print(f"ğŸ”¢ NumPy versiyonu: {np.__version__}")

# PyMuPDF'Ä± kontrol et
try:
    import fitz  # PyMuPDF
    import PyPDF2
    print("âœ… PDF kÃ¼tÃ¼phaneleri yÃ¼klendi!")
except ImportError as e:
    print(f"âŒ PDF kÃ¼tÃ¼phanesi hatasÄ±: {e}")
    print("ğŸ”§ PDF kÃ¼tÃ¼phaneleri yÃ¼kleniyor...")
    !pip install -q pymupdf PyPDF2
    import fitz
    import PyPDF2

# %%
# 3. DATA KLASÃ–RÃœNÃœ KESÄ°NLÄ°KLE OLUÅTUR
print("ğŸ“ Data klasÃ¶rÃ¼ oluÅŸturuluyor...")

# Data klasÃ¶rÃ¼nÃ¼ kesinlikle oluÅŸtur
data_folder = "data"
if not os.path.exists(data_folder):
    os.makedirs(data_folder)
    print(f"âœ… '{data_folder}' klasÃ¶rÃ¼ oluÅŸturuldu")
else:
    print(f"âœ… '{data_folder}' klasÃ¶rÃ¼ zaten var")

# KlasÃ¶r iÃ§eriÄŸini kontrol et
print(f"\nğŸ“‚ '{data_folder}' klasÃ¶rÃ¼ iÃ§eriÄŸi:")
try:
    files = os.listdir(data_folder)
    if files:
        for file in files:
            print(f"   ğŸ“„ {file}")
    else:
        print("   ğŸ“­ KlasÃ¶r boÅŸ")
except Exception as e:
    print(f"   âŒ KlasÃ¶r okuma hatasÄ±: {e}")

# %%
# 4. PDF OKUMA SÄ°STEMÄ°
class PDFReader:
    def __init__(self):
        pass

    def read_pdf(self, file_path):
        """PDF dosyasÄ±nÄ± oku ve metne Ã§evir"""
        try:
            text = ""

            # PyMuPDF ile okumayÄ± dene (daha iyi)
            try:
                doc = fitz.open(file_path)
                for page in doc:
                    text += page.get_text()
                doc.close()
                print(f"âœ… PDF okundu (PyMuPDF): {file_path}")
            except Exception as e:
                print(f"âš ï¸  PyMuPDF hatasÄ±, PyPDF2 deniyor: {e}")
                # PyPDF2 ile dene
                with open(file_path, 'rb') as file:
                    reader = PyPDF2.PdfReader(file)
                    for page in reader.pages:
                        text += page.extract_text()
                print(f"âœ… PDF okundu (PyPDF2): {file_path}")

            # Metni temizle
            text = self.clean_text(text)
            return text

        except Exception as e:
            print(f"âŒ PDF okuma hatasÄ±: {file_path} - {str(e)}")
            return None

    def clean_text(self, text):
        """Metni temizle ve dÃ¼zenle"""
        # Fazla boÅŸluklarÄ± kaldÄ±r
        text = re.sub(r'\s+', ' ', text)
        # SatÄ±r sonlarÄ±nÄ± dÃ¼zelt
        text = text.replace('\n', ' ').replace('\r', ' ')
        return text.strip()

# %%
# 5. GELÄ°ÅMÄ°Å DOSYA OKUMA SÄ°STEMÄ°
class AdvancedFileDataLoader:
    def __init__(self, data_folder="data"):
        self.data_folder = data_folder
        self.pdf_reader = PDFReader()
        # KlasÃ¶rÃ¼ KESÄ°NLÄ°KLE oluÅŸtur
        os.makedirs(data_folder, exist_ok=True)
        print(f"âœ… '{data_folder}' klasÃ¶rÃ¼ hazÄ±r")

    def create_sample_files(self):
        """Ã–rnek dosyalar oluÅŸtur"""
        sample_data = {
            "programlama.txt": """PYTHON PROGRAMLAMA

Fonksiyonlar: def anahtar kelimesiyle tanÄ±mlanÄ±r
Ã–rnek: def topla(a, b): return a + b

DÃ¶ngÃ¼ler: for ve while dÃ¶ngÃ¼leri
for i in range(5): print(i)

Listeler: KÃ¶ÅŸeli parantezle oluÅŸturulur
my_list = [1, 2, 3, 4, 5]

SÃ¶zlÃ¼kler: Anahtar-deÄŸer Ã§iftleri
my_dict = {"isim": "Ali", "yas": 20}""",

            "matematik.txt": """MATEMATÄ°K - TÃœREV VE Ä°NTEGRAL

TÃ¼rev: Fonksiyonun deÄŸiÅŸim oranÄ±
f(x) = xÂ² â†’ f'(x) = 2x

Integral: TÃ¼revin tersi iÅŸlem
âˆ«xÂ² dx = (xÂ³/3) + C

Trigonometri: sin, cos, tan fonksiyonlarÄ±
sin(90) = 1, cos(0) = 1

Geometri: ÃœÃ§gen, kare, daire alan hesaplamalarÄ±""",

            "fizik.txt": """FÄ°ZÄ°K YASALARI

Newton YasalarÄ±:
1. Eylemsizlik yasasÄ± - Hareket halindeki cisim durmak istemez
2. F = m * a - Kuvvet kÃ¼tle Ã§arpÄ± ivme
3. Etki-tepki yasasÄ± - Her etkiye eÅŸit tepki

Enerji: Enerji korunumu yasasÄ±
Kinetik enerji = (1/2) * m * vÂ²

Manyetizma: MÄ±knatÄ±slarÄ±n kutuplarÄ±, manyetik alan""",

            "tarih.txt": """TARÄ°H - OSMANLI DEVLETÄ°

KuruluÅŸ: 1299 - Osman Gazi
YÃ¼kselme: 1453 - Ä°stanbul'un fethi
BaÅŸkentler: SÃ¶ÄŸÃ¼t, Bursa, Edirne, Ä°stanbul

Ã–nemli PadiÅŸahlar:
- Fatih Sultan Mehmet: Ä°stanbul'u fethetti
- Kanuni Sultan SÃ¼leyman: En parlak dÃ¶nem
- Yavuz Sultan Selim: HalifeliÄŸi getirdi

KurtuluÅŸ SavaÅŸÄ±: 1919-1923 arasÄ±""",

            "kimya.txt": """KÄ°MYA - PERÄ°YODÄ°K TABLO

Elementler: Atom numaralarÄ±na gÃ¶re sÄ±ralanÄ±r
Gruplar: Dikey sÃ¼tunlar (1A-8A)
Periyotlar: Yatay satÄ±rlar (1-7)

Ã–nemli Elementler:
- Hidrojen (H): En hafif element
- Oksijen (O): Solunum iÃ§in gerekli
- AltÄ±n (Au): DeÄŸerli metal
- GÃ¼mÃ¼ÅŸ (Ag): Ä°letken metal

Kimyasal Tepkimeler: Yanma, Ã§Ã¶zÃ¼nme, sentez"""
        }

        created_count = 0
        for filename, content in sample_data.items():
            filepath = os.path.join(self.data_folder, filename)
            try:
                with open(filepath, 'w', encoding='utf-8') as f:
                    f.write(content)
                print(f"âœ… Ã–rnek dosya oluÅŸturuldu: {filename}")
                created_count += 1
            except Exception as e:
                print(f"âŒ Dosya oluÅŸturma hatasÄ±: {filename} - {e}")

        return created_count

    def load_from_files(self):
        """KlasÃ¶rdeki tÃ¼m dosyalarÄ± yÃ¼kle (PDF ve TXT)"""
        documents = []

        # Ã–nce klasÃ¶rÃ¼n var olduÄŸundan emin ol
        if not os.path.exists(self.data_folder):
            print(f"âŒ '{self.data_folder}' klasÃ¶rÃ¼ yok, oluÅŸturuluyor...")
            os.makedirs(self.data_folder)

        # KlasÃ¶rde dosya var mÄ± kontrol et
        files = os.listdir(self.data_folder)
        if not files:
            print("ğŸ“­ Data klasÃ¶rÃ¼ boÅŸ, Ã¶rnek dosyalar oluÅŸturuluyor...")
            created_count = self.create_sample_files()
            if created_count == 0:
                print("âŒ HiÃ§ dosya oluÅŸturulamadÄ±!")
                return documents
            # Yeniden listele
            files = os.listdir(self.data_folder)

        print(f"\nğŸ“‚ Data klasÃ¶rÃ¼nde {len(files)} dosya bulundu:")

        for filename in files:
            filepath = os.path.join(self.data_folder, filename)
            print(f"   ğŸ” Ä°ÅŸleniyor: {filename}")

            if filename.endswith('.txt'):
                # TXT dosyasÄ±nÄ± oku
                try:
                    with open(filepath, 'r', encoding='utf-8') as f:
                        content = f.read()

                    if not content.strip():
                        print(f"   âš ï¸  BoÅŸ dosya: {filename}")
                        continue

                    # Dosya adÄ±ndan konuyu Ã§Ä±kar
                    subject = filename.replace('.txt', '').lower()

                    documents.append({
                        'content': content,
                        'subject': subject,
                        'file_name': filename,
                        'source': 'txt_file',
                        'type': 'text'
                    })
                    print(f"   âœ… TXT yÃ¼klendi: {filename}")

                except Exception as e:
                    print(f"   âŒ TXT okuma hatasÄ±: {filename} - {str(e)}")

            elif filename.endswith('.pdf'):
                # PDF dosyasÄ±nÄ± oku
                content = self.pdf_reader.read_pdf(filepath)
                if content and content.strip():
                    # PDF adÄ±ndan konuyu Ã§Ä±kar
                    subject = filename.replace('.pdf', '').lower()

                    documents.append({
                        'content': content,
                        'subject': subject,
                        'file_name': filename,
                        'source': 'pdf_file',
                        'type': 'pdf'
                    })
                    print(f"   âœ… PDF yÃ¼klendi: {filename}")
                else:
                    print(f"   âŒ PDF iÃ§erik alÄ±namadÄ±: {filename}")

        print(f"\nğŸ“Š YÃœKLEME Ã–ZETÄ°:")
        print(f"   ğŸ“š Toplam belge: {len(documents)}")

        return documents

# %%
# 6. SÄ°STEMÄ° KUR
print("ğŸš€ PDF DESTEKLÄ° Ders AsistanÄ± Sistemi Kuruluyor...")

# Dosyalardan veri yÃ¼kle
file_loader = AdvancedFileDataLoader("data")
documents = file_loader.load_from_files()

if not documents:
    print("âŒ HiÃ§ belge yÃ¼klenemedi! Manuel dosya oluÅŸturuluyor...")
    manual_file = os.path.join("data", "manuel_ornek.txt")
    with open(manual_file, 'w', encoding='utf-8') as f:
        f.write("Python programlama dili. Fonksiyonlar def ile tanÄ±mlanÄ±r. Ã–rnek: def merhaba(): print('Merhaba')")
    print(f"âœ… Manuel dosya oluÅŸturuldu")
    documents = file_loader.load_from_files()

print(f"\nğŸ‰ BAÅARI! Toplam {len(documents)} belge yÃ¼klendi")

# %%
# 7. TF-IDF VEKTÃ–RLEÅTÄ°RME (GÃœNCEL NUMPY Ä°LE)
class AdvancedTextEncoder:
    def __init__(self):
        self.vocab = {}
        self.documents = []
        self.tfidf_matrix = None
        self.document_metadata = []

    def build_vocabulary(self, documents):
        """Kelimelerden oluÅŸan sÃ¶zlÃ¼k oluÅŸtur"""
        all_words = []
        for doc in documents:
            words = self._tokenize(doc['content'])
            all_words.extend(words)

        if not all_words:
            print("âŒ HiÃ§ kelime bulunamadÄ±!")
            return

        word_counts = Counter(all_words)
        self.vocab = {word: idx for idx, (word, _) in enumerate(word_counts.most_common(2000))}
        print(f"ğŸ“š Kelime daÄŸarcÄ±ÄŸÄ±: {len(self.vocab)} kelime")

    def _tokenize(self, text):
        """Metni kelimelere ayÄ±r"""
        text = text.lower()
        text = text.replace('ÄŸ', 'g').replace('Ã¼', 'u').replace('ÅŸ', 's').replace('Ä±', 'i').replace('Ã¶', 'o').replace('Ã§', 'c')
        words = re.findall(r'\b\w+\b', text)
        stop_words = {'bir', 've', 'ile', 'iÃ§in', 'ama', 'fakat', 'ancak', 'kadar', 'gibi', 'Ã¼zere', 'diye', 'dek'}
        return [word for word in words if len(word) > 2 and word not in stop_words]

    def compute_tfidf(self, documents):
        """TF-IDF vektÃ¶rlerini hesapla"""
        self.documents = []
        self.document_metadata = []

        n_docs = len(documents)
        if n_docs == 0:
            print("âŒ Ä°ÅŸlenecek belge yok!")
            return False

        print(f"ğŸ”§ {n_docs} belge iÅŸleniyor...")
        self.build_vocabulary(documents)

        n_vocab = len(self.vocab)
        if n_vocab == 0:
            print("âŒ Kelime daÄŸarcÄ±ÄŸÄ± oluÅŸturulamadÄ±!")
            return False

        # TF matrisi
        tf_matrix = np.zeros((n_docs, n_vocab))
        doc_word_count = np.zeros(n_docs)

        for doc_idx, doc in enumerate(documents):
            words = self._tokenize(doc['content'])
            doc_word_count[doc_idx] = len(words)

            for word in words:
                if word in self.vocab:
                    word_idx = self.vocab[word]
                    tf_matrix[doc_idx, word_idx] += 1

            if doc_word_count[doc_idx] > 0:
                tf_matrix[doc_idx] /= doc_word_count[doc_idx]

        # IDF hesapla
        doc_freq = np.sum(tf_matrix > 0, axis=0)
        idf_vector = np.log((n_docs + 1) / (doc_freq + 1)) + 1

        # TF-IDF matrisi
        self.tfidf_matrix = tf_matrix * idf_vector

        for doc in documents:
            self.documents.append(doc['content'])
            self.document_metadata.append({
                'subject': doc['subject'],
                'file_name': doc['file_name'],
                'source': doc.get('source', 'unknown'),
                'type': doc.get('type', 'unknown')
            })

        print(f"âœ… {n_docs} belge iÃ§in TF-IDF matrisi oluÅŸturuldu")
        return True

    def encode_query(self, query):
        """Sorguyu vektÃ¶re Ã§evir"""
        if not self.vocab:
            return None

        words = self._tokenize(query)
        vector = np.zeros(len(self.vocab))

        for word in words:
            if word in self.vocab:
                vector[self.vocab[word]] += 1

        if len(words) > 0:
            vector /= len(words)

        return vector

    def search(self, query, k=3, subject_filter=None):
        """Benzerlik aramasÄ± yap"""
        if self.tfidf_matrix is None:
            return []

        query_vector = self.encode_query(query)
        if query_vector is None:
            return []

        similarities = []
        for doc_idx, doc_vector in enumerate(self.tfidf_matrix):
            if subject_filter and subject_filter != "TÃ¼m Konular":
                doc_subject = self.document_metadata[doc_idx]['subject']
                if doc_subject != subject_filter:
                    similarities.append(0)
                    continue

            dot_product = np.dot(doc_vector, query_vector)
            doc_norm = np.linalg.norm(doc_vector)
            query_norm = np.linalg.norm(query_vector)

            if doc_norm > 0 and query_norm > 0:
                similarity = dot_product / (doc_norm * query_norm)
            else:
                similarity = 0

            similarities.append(similarity)

        indices = np.argsort(similarities)[-k:][::-1]

        results = []
        for idx in indices:
            if similarities[idx] > 0.1:
                results.append({
                    'content': self.documents[idx],
                    'metadata': self.document_metadata[idx],
                    'score': similarities[idx]
                })

        return results

# %%
# 8. RAG SÄ°STEMÄ°NÄ° BAÅLAT
print("ğŸ”§ RAG Sistemi BaÅŸlatÄ±lÄ±yor...")

encoder = AdvancedTextEncoder()
success = encoder.compute_tfidf(documents)

if not success:
    print("âŒ TF-IDF oluÅŸturulamadÄ±!")
else:
    print("âœ… TF-IDF baÅŸarÄ±yla oluÅŸturuldu")

# %%
# 9. GELÄ°ÅMÄ°Å RAG SÄ°STEMÄ°
class AdvancedRAG:
    def __init__(self, encoder):
        self.encoder = encoder

    def get_subject_stats(self):
        """Konu bazlÄ± istatistikleri gÃ¶ster"""
        if not self.encoder.document_metadata:
            print("âŒ HiÃ§ belge yÃ¼klenmemiÅŸ!")
            return {}

        subjects = {}
        for meta in self.encoder.document_metadata:
            subject = meta['subject']
            if subject in subjects:
                subjects[subject] += 1
            else:
                subjects[subject] = 1

        print("\nğŸ“Š KONU Ä°STATÄ°STÄ°KLERÄ°:")
        print("-" * 40)
        for subject, count in subjects.items():
            print(f"   ğŸ“š {subject}: {count} belge")
        return subjects

    def get_available_subjects(self):
        """Mevcut konularÄ± listele"""
        if not self.encoder.document_metadata:
            return []

        subjects = set()
        for meta in self.encoder.document_metadata:
            subjects.add(meta['subject'])
        return sorted(list(subjects))

    def show_available_subjects(self):
        """Mevcut konularÄ± gÃ¶ster"""
        subjects = self.get_available_subjects()
        print("\nğŸ¯ MEVCUT KONULAR:")
        print("-" * 30)
        if subjects:
            for i, subject in enumerate(subjects, 1):
                print(f"   {i}. {subject}")
        else:
            print("   ğŸ“­ HiÃ§ konu bulunamadÄ±")
        print("-" * 30)
        return subjects

    def get_enhanced_answer(self, question, subject="TÃ¼m Konular"):
        """GeliÅŸmiÅŸ formatlÄ± cevap"""
        if not self.encoder.documents:
            return "âŒ Sistem henÃ¼z hazÄ±r deÄŸil!"

        results = self.encoder.search(question, k=3, subject_filter=subject)

        if not results:
            return self._get_no_answer_response(question, subject)

        return self._format_answer(results, question, subject)

    def _get_no_answer_response(self, question, subject):
        """Cevap bulunamadÄ±ÄŸÄ±nda"""
        available_subjects = self.get_available_subjects()

        if subject == "TÃ¼m Konular":
            return f"""ğŸ¤” **Cevap BulunamadÄ±**

"{question}" sorusu iÃ§in bilgi bankamda yeterli bilgi bulamadÄ±m.

ğŸ“š **Mevcut Konular:** {', '.join(available_subjects) if available_subjects else 'HiÃ§ konu yok'}"""
        else:
            return f"""ğŸ¤” **{subject.upper()} Konusunda Cevap BulunamadÄ±**

"{question}" sorusu iÃ§in {subject} konusunda yeterli bilgi bulamadÄ±m."""

    def _format_answer(self, results, question, subject):
        """CevabÄ± formatla"""
        answer_parts = []
        answer_parts.append("ğŸ¯ **ASÄ°STAN CEVABI**")
        answer_parts.append("=" * 50)

        best_result = results[0]
        best_content = self._extract_relevant_part(best_result['content'], question)
        file_type = "ğŸ“„ PDF" if best_result['metadata'].get('type') == 'pdf' else "ğŸ“– TXT"

        answer_parts.append(f"**{file_type} {best_result['metadata']['subject'].upper()}**")
        answer_parts.append(f"ğŸ“ Dosya: {best_result['metadata']['file_name']}")
        answer_parts.append("")
        answer_parts.append(f"**ğŸ“ Ä°lgili Bilgi:**")
        answer_parts.append(f"_{best_content}_")
        answer_parts.append("")

        if len(results) > 1:
            answer_parts.append("**ğŸ” DÄ°ÄER KAYNAKLAR:**")
            for i, result in enumerate(results[1:], 2):
                file_type = "ğŸ“„" if result['metadata'].get('type') == 'pdf' else "ğŸ“–"
                preview = result['content'][:100] + "..." if len(result['content']) > 100 else result['content']
                answer_parts.append(f"{i}. {file_type} **{result['metadata']['subject']}**: {preview}")
            answer_parts.append("")

        answer_parts.append("**ğŸ“Š ARAMA SONUÃ‡LARI:**")
        answer_parts.append(f"â€¢ Toplam kaynak: {len(results)}")
        answer_parts.append(f"â€¢ SeÃ§ilen konu: {subject}")
        answer_parts.append("")
        answer_parts.append("ğŸ’¡ *Daha detaylÄ± bilgi iÃ§in farklÄ± sorular sorabilirsiniz*")

        return "\n".join(answer_parts)

    def _extract_relevant_part(self, content, question):
        """Ä°Ã§erikten soruyla ilgili kÄ±smÄ± Ã§Ä±kar"""
        sentences = content.split('. ')
        question_words = set(self.encoder._tokenize(question))

        best_sentence = ""
        best_score = 0

        for sentence in sentences:
            if len(sentence.strip()) < 10:
                continue

            sentence_words = set(self.encoder._tokenize(sentence))
            common_words = question_words.intersection(sentence_words)
            score = len(common_words)

            if score > best_score:
                best_score = score
                best_sentence = sentence.strip()

        if best_sentence and best_score >= 1:
            return best_sentence

        return content[:200] + "..." if len(content) > 200 else content

# %%
# 10. SÄ°STEMÄ° BAÅLAT
if success:
    rag_system = AdvancedRAG(encoder)

    print("\n" + "ğŸ¯" * 20)
    print("DERS ASÄ°STANI SÄ°STEMÄ° HAZIR!")
    print("ğŸ¯" * 20)

    rag_system.get_subject_stats()
    rag_system.show_available_subjects()

    print("\nğŸ‰ SÄ°STEM HAZIR! AÅŸaÄŸÄ±daki menÃ¼yÃ¼ kullanabilirsiniz.")
else:
    print("âŒ SÄ°STEM HAZIR DEÄÄ°L!")
    rag_system = None

# %%
# 11. BASÄ°T CHAT ARAYÃœZÃœ
def simple_chat(rag_system):
    """Basit chat arayÃ¼zÃ¼"""
    if rag_system is None:
        print("âŒ Sistem hazÄ±r deÄŸil!")
        return

    print("\n" + "="*60)
    print("ğŸ¤– DERS ASÄ°STANI CHATBOT")
    print("="*60)

    available_subjects = rag_system.show_available_subjects()

    if not available_subjects:
        print("âŒ HiÃ§ konu bulunamadÄ±!")
        return

    print("\nğŸ¯ **KOMUTLAR:**")
    print("   'tÃ¼m'    - TÃ¼m Konularda Ara")
    print("   'istat'  - Ä°statistikler")
    print("   'konu'   - KonularÄ± gÃ¶ster")
    print("   'quit'   - Ã‡Ä±kÄ±ÅŸ")
    print("-"*60)

    while True:
        subject_input = input("\nğŸ“– Konu seÃ§in (veya komut): ").strip().lower()

        if subject_input == 'quit':
            print("ğŸ‘‹ GÃ¶rÃ¼ÅŸmek Ã¼zere!")
            break
        elif subject_input == 'istat':
            rag_system.get_subject_stats()
            continue
        elif subject_input == 'konu':
            rag_system.show_available_subjects()
            continue
        elif subject_input == 'tÃ¼m':
            subject = "TÃ¼m Konular"
        elif subject_input in available_subjects:
            subject = subject_input
        else:
            print(f"âš ï¸  GeÃ§ersiz! Mevcut konular: {', '.join(available_subjects)}")
            continue

        question = input(f"\nğŸ’­ [{subject}] Sorunuz: ").strip()

        if question.lower() in ['quit', 'exit', 'Ã§Ä±k']:
            print("ğŸ‘‹ GÃ¶rÃ¼ÅŸmek Ã¼zere!")
            break

        if not question:
            print("âš ï¸ LÃ¼tfen bir soru girin!")
            continue

        print("\nğŸ” Bilgilerim aranÄ±yor...")
        answer = rag_system.get_enhanced_answer(question, subject)

        print("\n" + "="*50)
        print(answer)
        print("="*50)

# %%
# 12. ANA MENÃœ
def main_menu():
    """Ana menÃ¼"""
    current_system = rag_system

    while True:
        print("\nğŸ”§ **ANA MENÃœ**")
        print("1. ğŸ’¬ Chat Botunu BaÅŸlat")
        print("2. ğŸ“Š Ä°statistikleri GÃ¶ster")
        print("3. ğŸ¯ KonularÄ± Listele")
        print("4. ğŸ”„ Sistemi Yeniden BaÅŸlat")
        print("5. ğŸšª Ã‡Ä±kÄ±ÅŸ")

        choice = input("\nSeÃ§iminiz (1-5): ").strip()

        if choice == "1":
            simple_chat(current_system)
        elif choice == "2":
            if current_system:
                current_system.get_subject_stats()
            else:
                print("âŒ Sistem hazÄ±r deÄŸil!")
        elif choice == "3":
            if current_system:
                current_system.show_available_subjects()
            else:
                print("âŒ Sistem hazÄ±r deÄŸil!")
        elif choice == "4":
            print("ğŸ”„ Sistem yeniden baÅŸlatÄ±lÄ±yor...")
            new_documents = file_loader.load_from_files()
            if new_documents:
                new_encoder = AdvancedTextEncoder()
                new_success = new_encoder.compute_tfidf(new_documents)
                if new_success:
                    current_system = AdvancedRAG(new_encoder)
                    print("âœ… Sistem baÅŸarÄ±yla yeniden baÅŸlatÄ±ldÄ±!")
                    current_system.get_subject_stats()
                else:
                    print("âŒ Sistem yeniden baÅŸlatÄ±lamadÄ±!")
            else:
                print("âŒ HiÃ§ dosya yÃ¼klenemedi!")
        elif choice == "5":
            print("ğŸ‘‹ GÃ¶rÃ¼ÅŸmek Ã¼zere!")
            break
        else:
            print("âš ï¸  GeÃ§ersiz seÃ§im! 1-5 arasÄ± bir sayÄ± girin.")

# %%
# 13. PROGRAMI BAÅLAT
if rag_system is not None:
    main_menu()
else:
    print("âŒ Sistem baÅŸlatÄ±lamadÄ±!")